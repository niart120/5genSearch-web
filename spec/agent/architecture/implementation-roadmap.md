# 実装ロードマップ

フロントエンド実装の順序と依存関係を定義する。

## 1. 実装方針

**レイヤーボトムアップ**アプローチを採用：

1. 基盤レイヤーを先に整備
2. UI 実装に集中できる状態を作る
3. デザインの一貫性にリソースを投下

## 2. フェーズ構成

```
Phase 1: 基盤整備
    ├── WASM バインディング検証
    ├── Worker 基盤
    └── 状態管理基盤
            │
            ▼
Phase 2: 共通コンポーネント
    ├── UI 部品 (Radix UI + Tailwind)
    ├── フォーム部品
    └── レイアウト部品
            │
            ▼
Phase 3: 機能実装
    ├── DS 設定
    ├── 起動時刻検索
    ├── 個体生成リスト
    ├── 孵化検索
    └── misc (針/MTSeed/TID)
            │
            ▼
Phase 4: 仕上げ
    ├── エクスポート機能
    ├── レスポンシブ調整
    └── パフォーマンス最適化
```

## 3. Phase 1: 基盤整備

### 3.1 WASM バインディング検証

| タスク | 説明 | 成果物 |
|-------|------|--------|
| API 網羅性確認 | d.ts と実装の差異確認 | 不足 API リスト |
| bindgen 付与漏れ修正 | `generate_pokemon_list` 等 | 修正 PR |
| GPU API 確認 | ビルドオプション確認 | 対応方針 |
| ヘルスチェック | `health_check()` 動作確認 | テストコード |

### 3.2 Worker 基盤

| タスク | 説明 | 成果物 |
|-------|------|--------|
| CPU Worker エントリポイント | `search.worker.ts` | 実装 |
| GPU Worker エントリポイント | `gpu.worker.ts` | 実装 |
| WASM 初期化 | Worker 内での init | 実装 |
| メッセージ型定義 | Request/Response 型 | `workers/types.ts` |
| WorkerPool 実装 | spawn/dispatch/collect | `services/worker-pool.ts` |
| 進捗集約 | AggregatedProgress | `services/progress.ts` |
| キャンセル処理 | 中断フロー | 実装 |

### 3.3 状態管理基盤

| タスク | 説明 | 成果物 |
|-------|------|--------|
| ライブラリ PoC | Jotai vs Zustand 検証 | 選定結果 |
| Store 分割設計 | 永続化/非永続化分類 | 設計ドキュメント |
| 永続化実装 | localStorage 連携 | 実装 |
| カスタムフック | Store 隠蔽フック | `hooks/` |

### 3.4 i18n 基盤

| タスク | 説明 | 成果物 |
|-------|------|--------|
| ライブラリ選定 | react-i18next / lingui 比較 | 選定結果 |
| リソース形式決定 | JSON vs TypeScript | 設計ドキュメント |
| 翻訳キー命名規則 | 機能別プレフィックス等 | 規約ドキュメント |
| 初期リソース作成 | ja.ts / en.ts | 実装 |

## 4. Phase 2: 共通コンポーネント

### 4.1 UI 部品

| コンポーネント | ベース | 備考 |
|--------------|-------|------|
| Button | Radix UI | バリアント対応 |
| Input | Radix UI | 数値/テキスト |
| Select | Radix UI | 単一/複数選択 |
| Checkbox | Radix UI | |
| Tabs | Radix UI | 機能切り替え |
| Dialog | Radix UI | モーダル |
| Toast | Radix UI | 通知 |

### 4.2 フォーム部品

| コンポーネント | 説明 |
|--------------|------|
| IvRangeInput | IV 範囲入力 (6ステータス) |
| DateRangePicker | 日付範囲選択 |
| TimeRangePicker | 時刻範囲選択 |
| MacAddressInput | MAC アドレス入力 |
| NatureSelect | 性格選択 (複数可) |
| HiddenPowerSelect | めざパタイプ選択 |

### 4.3 レイアウト部品

| コンポーネント | 説明 |
|--------------|------|
| Header | アプリヘッダー |
| Sidebar | 設定サイドバー (PC) |
| ResponsiveContainer | レスポンシブレイアウト |
| ProgressOverlay | 進捗表示オーバーレイ |

### 4.4 データ表示部品

| コンポーネント | 説明 |
|--------------|------|
| ResultTable | PC 向けテーブル表示 |
| ResultCard | モバイル向けカード表示 |
| ProgressBar | 進捗バー |
| Pagination | ページネーション |

## 5. Phase 3: 機能実装

### 5.1 実装順序

1. **DS 設定** (他機能の前提)
2. **起動時刻検索** (最も基本的な機能)
3. **個体生成リスト** (検索結果の活用)
4. **孵化検索** (BW 専用)
5. **misc 機能群** (針/MTSeed/TID)

### 5.2 各機能の構成

```
features/{feature}/
├── components/
│   ├── {Feature}Page.tsx      # ページ
│   ├── {Feature}Form.tsx      # 入力フォーム
│   └── {Feature}Results.tsx   # 結果表示
├── hooks/
│   └── use-{feature}.ts       # 機能ロジック
└── types.ts                   # 機能固有型
```

## 6. Phase 4: 仕上げ

### 6.1 エクスポート機能

| 形式 | 対象 | 優先度 |
|-----|------|-------|
| CSV | 検索結果 | 高 |
| JSON | 検索結果 + 条件 | 中 |
| テキスト | クリップボード | 高 |

### 6.2 レスポンシブ調整

- 各機能のモバイル表示確認
- タッチ操作最適化
- 入力 UI 調整

### 6.3 パフォーマンス最適化

- 結果リストの仮想スクロール
- 不要な再レンダリング削減
- バンドルサイズ確認

## 7. 依存関係グラフ

```
[WASM 検証] ──────────────────────────────┐
      │                                    │
      ▼                                    ▼
[Worker 基盤] ◄──────────────────── [状態管理基盤]
      │                                    │
      └──────────────┬─────────────────────┘
                     ▼
              [共通コンポーネント]
                     │
      ┌──────────────┼──────────────┐
      ▼              ▼              ▼
[DS 設定]     [起動時刻検索]    [個体生成]
      │              │              │
      └──────────────┴──────────────┘
                     │
      ┌──────────────┼──────────────┐
      ▼              ▼              ▼
  [孵化検索]     [針検索]      [MTSeed/TID]
                     │
                     ▼
              [エクスポート]
```

## 8. 見積もり (目安)

| フェーズ | 規模感 |
|---------|-------|
| Phase 1 | 基盤整備 (Worker + Store) |
| Phase 2 | UI 部品 10-15 種 |
| Phase 3 | 機能 6 種 |
| Phase 4 | 仕上げ |

## 9. 検討事項

- [ ] WASM API の不足分洗い出し
- [ ] 状態管理ライブラリの選定
- [ ] 現行アプリからの UI 資産流用可否
